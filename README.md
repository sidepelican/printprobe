# PrintProbe
ãƒ—ãƒ­ãƒ¼ãƒ–è¦æ±‚ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¦ã¿ã‚ˆã†ã¨ã„ã†èª²é¡Œ

Raspberry Piã‚„Macã§ãƒ—ãƒ­ãƒ¼ãƒ–è¦æ±‚ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¦å†…å®¹ã‚’è¡¨ç¤ºã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã£ã¦ã¿ã‚ˆã†ğŸ’ª


## Goç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯golangã§æ›¸ã‹ã‚Œã¦ã„ã¾ã™
- Goã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †: http://golang-jp.org/doc/install

golangã§ä½œæˆã—ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯1ã¤ã®ãƒã‚¤ãƒŠãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãªã‚‹ãŸã‚å–ã‚Šå›ã—ãŒå®¹æ˜“ã§ã™
- Node.jsã‚„Rubyã§ã¯ `npm install` ãªã©ãŒå¿…è¦ã§ã€ç‰¹ã«ã‚»ãƒ³ã‚µç’°å¢ƒã§ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ã‚³ã‚±ã‚‹ã“ã¨ãŒå¤šã„ã§ã™
- ã¾ãŸ `node` ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒé•ã†ãªã©ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã®ã¯æ—¥å¸¸èŒ¶é£¯äº‹ã§ã‚ã‚Šã€ãã‚Œã‚‰ã®å³å¯†ãªç®¡ç†ã‚‚å¿…è¦ã¨ãªã‚Šã¾ã™
- è²§å¼±ãªãƒ¡ãƒ¢ãƒªãƒ»ãƒ—ãƒ­ã‚»ãƒƒã‚µã®å ´åˆã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«æ™‚é–“ãŒã‹ã‹ã‚‹ã“ã¨ã‚‚ã—ã°ã—ã°ã§ã™

ã“ã®ãŸã‚è¤‡æ•°ã‚»ãƒ³ã‚µç’°å¢ƒã«ãŠã„ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®¹æ˜“ã§ã©ã®ã‚»ãƒ³ã‚µç«¯æœ«ã«ç½®ã„ã¦ã‚‚åŒã˜å‹•ä½œãŒæœŸå¾…ã§ãã‚‹ã‚·ãƒ³ã‚°ãƒ«ãƒã‚¤ãƒŠãƒªå‹ã®å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ãŒæœ‰ç”¨ã§ã‚ã‚‹ã¨è€ƒãˆã€
ãã®ãŸã‚ã«GoãŒç”¨ã„ã‚‰ã‚Œã¦ã„ã¾ã™


## ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼†å®Ÿè¡Œ

ã“ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã¯å¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦ `github.com/sidepelican/goprobe/probe` ([goprobe](https://github.com/sidepelican/goprobe))ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™  
ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹å‰ã«ã‚ã‚‰ã‹ã˜ã‚ä½¿ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ `go get` ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

```
> go get github.com/sidepelican/goprobe/probe
```

ãƒ“ãƒ«ãƒ‰ã¯ `go build` ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚è‡ªå‹•çš„ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¢ã—ã¦åå‰ã‚‚ã¤ã‘ã¦ãã‚Œã¾ã™

```
> go build
```

ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ãƒ¢ãƒ‹ã‚¿ãƒ¢ãƒ¼ãƒ‰ã§ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã¯ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ã¨ãªã‚‹ãŸã‚ã€å®Ÿè¡Œã™ã‚‹éš›ã¯sudoã‚’ã¤ã‘ã¾ã™

```
> sudo ./printprobe
2018/02/18 22:01:20 used interface: en1
2018/02/18 22:01:20 pcap version: libpcap version 1.8.1 -- Apple version 79.20.1
...
```

## å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’è»¢é€ã™ã‚‹

ã©ã†ã‚„ã£ã¦è»¢é€ã™ã‚‹ã‹ğŸ¤”  
ğŸ‘‰ MQTT  
ğŸ‘‰ HTTP POST  
ğŸ‘‰ fluentd

### MQTTã®ä¾‹
MQTTã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª `phao.mqtt` ã‚’ä½¿ç”¨ã™ã‚‹

```:go
import (
    ...

    MQTT "github.com/eclipse/paho.mqtt.golang" // ğŸ‘ˆ è¿½åŠ 
)
```

```:go
// MQTTã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
opts := MQTT.NewClientOptions()
opts.AddBroker("your.broker.address")

client := MQTT.NewClient(opts)
if token := client.Connect(); token.Wait() && token.Error() != nil {
    fmt.Println("MQTT Error:", token.Error())
    return
}
defer client.Disconnect(250)

...

for record := range source.Records() {
    ...

    // MQTTã§é€ä¿¡
    payload := []byte(record.String())
    client.Publish("your/topic", 2, false, payload)
}
```
